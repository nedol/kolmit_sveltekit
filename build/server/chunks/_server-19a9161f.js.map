{"version":3,"file":"_server-19a9161f.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/operator/_server.js"],"sourcesContent":["import \"../../../chunks/index.js\";\nimport { r as rtcPool_st } from \"../../../chunks/stores.js\";\nrtcPool_st.subscribe((data) => {\n  global.rtcPool = data;\n});\nconst config = {\n  // runtime: 'edge'\n  // isr: {\n  // \texpiration: false // 10\n  // }\n};\nasync function GET(event) {\n  let q = {};\n  q.func = event.url.searchParams.get(\"func\");\n  q.role = event.url.searchParams.get(\"role\");\n  q.uid = event.url.searchParams.get(\"uid\");\n  q.abonent = event.url.searchParams.get(\"abonent\");\n  q.type = event.url.searchParams.get(\"type\");\n  q.em = event.url.searchParams.get(\"em\");\n  let resp;\n  switch (q.func) {\n    case \"callwaiting\":\n      try {\n        let promise = new Promise((resolve, reject) => {\n          CallWaiting(q, resolve);\n          if (global.rtcPool[q.type][q.abonent][q.em].resolve_post)\n            global.rtcPool[q.type][q.abonent][q.em].resolve_post();\n          rtcPool_st.set(global.rtcPool);\n        });\n        resp = await promise;\n        global.rtcPool[q.type][q.abonent][q.em].promise = new Promise((resolve, reject) => {\n          global.rtcPool[q.type][q.abonent][q.em].resolve_post = resolve;\n          rtcPool_st.set(global.rtcPool);\n        });\n      } catch (ex) {\n        console.log(\"callwaiting\" + ex);\n      }\n      break;\n  }\n  let response = new Response(JSON.stringify({ resp }));\n  response.headers.append(\"Access-Control-Allow-Origin\", `*`);\n  return response;\n}\nasync function POST(event) {\n  const { par } = await event.request.json();\n  const q = par;\n  let resp;\n  switch (q.func) {\n    case \"callwaiting\":\n      try {\n        let promise = new Promise((resolve, reject) => {\n          CallWaiting(q, resolve);\n          if (global.rtcPool[q.type][q.abonent][q.em].resolve_post)\n            global.rtcPool[q.type][q.abonent][q.em].resolve_post();\n        });\n        resp = await promise;\n        global.rtcPool[q.type][q.abonent][q.em].promise = new Promise((resolve, reject) => {\n          global.rtcPool[q.type][q.abonent][q.em].resolve_post = resolve;\n        });\n      } catch (ex) {\n        console.log(\"callwaiting\" + ex);\n      }\n      break;\n  }\n  let response = new Response(JSON.stringify({ resp }));\n  response.headers.append(\"Access-Control-Allow-Origin\", `*`);\n  return response;\n}\nfunction CallWaiting(q, resolve) {\n  try {\n    if (!global.rtcPool[q.type][q.abonent])\n      global.rtcPool[q.type][q.abonent] = {};\n    if (!global.rtcPool[q.type][q.abonent][q.em])\n      global.rtcPool[q.type][q.abonent][q.em] = { resolve: \"\" };\n    global.rtcPool[q.type][q.abonent][q.em].resolve = resolve;\n  } catch (e) {\n    console.log();\n  }\n}\nexport {\n  GET,\n  POST,\n  config\n};\n"],"names":[],"mappings":"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"}