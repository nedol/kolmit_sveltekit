{"version":3,"file":"_server-1ab6e162.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/user/_server.js"],"sourcesContent":["import \"../../../chunks/index.js\";\nimport { r as rtcPool_st } from \"../../../chunks/stores.js\";\nrtcPool_st.subscribe((data) => {\n  global.rtcPool = data;\n});\nconst config = {\n  // runtime: 'edge'\n  // isr: {\n  // \texpiration: false // 10\n  // }\n};\nasync function GET(event) {\n  let q = {};\n  q.abonent = event.url.searchParams.get(\"abonent\");\n  q.type = event.url.searchParams.get(\"type\");\n  q.em = event.url.searchParams.get(\"em\");\n  let resp;\n  try {\n    let promise = new Promise((resolve, reject) => {\n      try {\n        OperatorWaiting(q, resolve);\n        rtcPool_st.set(global.rtcPool);\n      } catch (ex) {\n        console.log(ex);\n      }\n    });\n    resp = await promise;\n  } catch (ex) {\n    console.log(ex);\n  }\n  let response = new Response(JSON.stringify({ resp }));\n  response.headers.append(\"Access-Control-Allow-Origin\", `*`);\n  return response;\n}\nasync function POST(event) {\n  const { par } = await event.request.json();\n  const q = par;\n  let resp = {};\n  try {\n    let promise = new Promise((resolve, reject) => {\n      try {\n        OperatorWaiting(q, resolve);\n        set(\"global.rtcPool\", global.rtcPool);\n      } catch (ex) {\n        console.log(ex);\n      }\n    });\n    resp = await promise;\n  } catch (ex) {\n    console.log(par.func + ex);\n  }\n  let response = new Response(JSON.stringify({ resp }));\n  response.headers.append(\"Access-Control-Allow-Origin\", `*`);\n  return response;\n}\nfunction OperatorWaiting(q, resolve) {\n  try {\n    if (!global.rtcPool[q.type][q.abonent])\n      global.rtcPool[q.type][q.abonent] = {};\n    if (!global.rtcPool[q.type][q.abonent][q.em])\n      global.rtcPool[q.type][q.abonent][q.em] = { resolve: \"\" };\n    global.rtcPool[q.type][q.abonent][q.em].resolve = resolve;\n  } catch (ex) {\n    console.log(\"OperatorWaiting ex:\" + ex);\n  }\n}\nexport {\n  GET,\n  POST,\n  config\n};\n"],"names":[],"mappings":"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"}